!new function(a){var b=a.separator||"&",c=a.spaces===!1?!1:!0,d=(a.suffix===!1?"":"[]",a.prefix===!1?!1:!0),e=d?a.hash===!0?"#":"?":"",f=a.numbers===!1?!1:!0;jQuery.query=new function(){var a=function(a,b){return void 0!=a&&null!==a&&(b?a.constructor==b:!0)},d=function(a){for(var b,c=/\[([^[]*)\]/g,d=/^([^[]+)(\[.*\])?$/.exec(a),e=d[1],f=[];b=c.exec(d[2]);)f.push(b[1]);return[e,f]},g=function(b,c,d){var e=c.shift();if("object"!=typeof b&&(b=null),""===e)if(b||(b=[]),a(b,Array))b.push(0==c.length?d:g(null,c.slice(0),d));else if(a(b,Object)){for(var f=0;null!=b[f++];);b[--f]=0==c.length?d:g(b[f],c.slice(0),d)}else b=[],b.push(0==c.length?d:g(null,c.slice(0),d));else if(e&&e.match(/^\s*[0-9]+\s*$/)){var h=parseInt(e,10);b||(b=[]),b[h]=0==c.length?d:g(b[h],c.slice(0),d)}else{if(!e)return d;var h=e.replace(/^\s*|\s*$/g,"");if(b||(b={}),a(b,Array)){for(var i={},f=0;f<b.length;++f)i[f]=b[f];b=i}b[h]=0==c.length?d:g(b[h],c.slice(0),d)}return b},h=function(a){var b=this;return b.keys={},a.queryObject?jQuery.each(a.get(),function(a,c){b.SET(a,c)}):jQuery.each(arguments,function(){var a=""+this;a=a.replace(/^[?#]/,""),a=a.replace(/[;&]$/,""),c&&(a=a.replace(/[+]/g," ")),jQuery.each(a.split(/[&;]/),function(){var a=decodeURIComponent(this.split("=")[0]||""),c=decodeURIComponent(this.split("=")[1]||"");a&&(f&&(/^[+-]?[0-9]+\.[0-9]*$/.test(c)?c=parseFloat(c):/^[+-]?[0-9]+$/.test(c)&&(c=parseInt(c,10))),c=c||0===c?c:!0,c!==!1&&c!==!0&&"number"!=typeof c&&(c=c),b.SET(a,c))})}),b};return h.prototype={queryObject:!0,has:function(b,c){var d=this.get(b);return a(d,c)},GET:function(b){if(!a(b))return this.keys;for(var c=d(b),e=c[0],f=c[1],g=this.keys[e];null!=g&&0!=f.length;)g=g[f.shift()];return"number"==typeof g?g:g||""},get:function(b){var c=this.GET(b);return a(c,Object)?jQuery.extend(!0,{},c):a(c,Array)?c.slice(0):c},SET:function(b,c){var e=a(c)?c:null,f=d(b),h=f[0],i=f[1],j=this.keys[h];return this.keys[h]=g(j,i.slice(0),e),this},set:function(a,b){return this.copy().SET(a,b)},REMOVE:function(a){return this.SET(a,null).COMPACT()},remove:function(a){return this.copy().REMOVE(a)},EMPTY:function(){var a=this;return jQuery.each(a.keys,function(b,c){delete a.keys[b]}),a},load:function(a){var b=a.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1"),c=a.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new h(a.length==c.length?"":c,a.length==b.length?"":b)},empty:function(){return this.copy().EMPTY()},copy:function(){return new h(this)},COMPACT:function(){function b(c){function d(b,c,d){a(b,Array)?b.push(d):b[c]=d}var e="object"==typeof c?a(c,Array)?[]:{}:c;return"object"==typeof c&&jQuery.each(c,function(c,f){return a(f)?void d(e,c,b(f)):!0}),e}return this.keys=b(this.keys),this},compact:function(){return this.copy().COMPACT()},toString:function(){var d=[],f=[],g=function(a){return a+="",c&&(a=a.replace(/ /g,"+")),encodeURIComponent(a)},h=function(b,c,d){if(a(d)&&d!==!1){var e=[g(c)];d!==!0&&(e.push("="),e.push(g(d))),b.push(e.join(""))}},i=function(a,b){var c=function(a){return b&&""!=b?[b,"[",a,"]"].join(""):[a].join("")};jQuery.each(a,function(a,b){"object"==typeof b?i(b,c(a)):h(f,c(a),b)})};return i(this.keys),f.length>0&&d.push(e),d.push(f.join(b)),d.join("")}},new h(location.search,location.hash)}}(jQuery.query||{}),$(function(){function a(a){var b=E.storeNotOpenTime;if(a.open){var b=a.openTime.substr(0,5)+"-"+a.closeTime.substr(0,5);(a.open24Hours||"00:00-00:00"==b)&&(b=E.storeOpen24Hours)}return b}function b(b,c){var d,e,f={data:{},groups:[]};for(var g in c){var h=c[g];f.data[h]=a(b[F[h]]),f.data[h]!=e?(d=[],d.push(h),e=f.data[h],d&&f.groups.push(d)):(d||(d=[]),d.push(h))}return f}function c(a){var b=a.parent().children();b.not(a).find(".mapdetail").slideUp(500),b.css("borderBottom","1px solid #e3e3e3").removeClass("map-select"),$(".arrow_b").css("display","block"),$(".arrow_t").css("display","none"),a.find(".mapdetail").slideDown(500,function(){for(var c=a.index(),d=0,e=0;c>e;e++){var f=b.eq(e);d+=f.height()+parseInt(f.css("padding-top"))+1}a.parents(".storeInfoListContainer").animate({scrollTop:d},500)}),a.css("borderBottom","0px"),a.find(".arrow_b").css("display","none"),a.find(".arrow_t").css("display","block"),a.addClass("map-select"),r&&a.attr("storeId")!=r.storeId&&r.setAnimation(G.none),r=y[a.attr("storeId")].marker,r.setAnimation(G.bounce)}function d(a){var c=a.regularHours,d="",e=b(c,[1,2,3,4,5,6,0]);for(var f in e.groups){var g=e.groups[f];d+="<p>"+(g.length>1?E[F[g[0]]]+" "+E.to+" "+E[F[g[g.length-1]]]:E[F[g[0]]])+"："+e.data[g[0]]+"</p>"}for(var h=[{storeId:a.id,storeSymbol:"",storeName:a.name,storeAddress:a.address.city+(a.address.streetAddressLine1?a.address.streetAddressLine1:"")+(a.address.streetAddressLine2?a.address.streetAddressLine2:"")+(a.address.streetAddressLine3?a.address.streetAddressLine3:""),storePhone:a.phoneNumber||"",storeOpenInfoHtml:d}],f=0;f<h.length;f++){var i=E.storeOpen,j=$('<li class="mapclick" storeid="'+h[f].storeId+'"><table cellpadding="0" cellspacing="0" border="0"><tr><td class="width-20"><p class="list_no">'+h[f].storeSymbol+'</p></td><td class="width-80"><p>'+h[f].storeName+'</p><p class="map_left-p">'+h[f].storeAddress+'</p></td></tr></table><div class="mapdetail"><p>'+i+"</p>"+h[f].storeOpenInfoHtml+"</div></li>");$(".map_left ul").append(j)}}function e(a,b){var d=new AMap.Marker({map:p,position:new AMap.LngLat(a.coordinates.longitude,a.coordinates.latitude),icon:B,animation:G.drop,clickable:!0});return d.storeId=a.id,d.on("click",function(){r&&d.storeId==r.storeId&&s&&s.getIsOpen()||(c($(".map_left.pc-map-left ul").find("li[storeId="+a.id+"]")),c($(".map_left.phone-map-left ul").find("li[storeId="+a.id+"]")),g(this,y[this.storeId].inst))}),d}function f(a){a.find(".mapdetail").slideUp(500),$(".map_left li").css("borderBottom","1px solid #e3e3e3"),a.find(".arrow_b").css("display","block"),a.find(".arrow_t").css("display","none"),a.removeClass("map-select")}function g(a,b){s&&s.close();var c=document.createElement("div");c.classList.add("map-hover");var d=document.createElement("img");d.setAttribute("src","/_themes/starbucks/img/map-close.gif"),d.setAttribute("style","position:absolute;right:0px;cursor:pointer;margin:5px 5px 0 0"),d.addEventListener("click",function(){s&&(s.close(),r&&(r.setAnimation(G.none),f($(".map_left.pc-map-left ul").find("li[storeId="+r.storeId+"]")),f($(".map_left.phone-map-left ul").find("li[storeId="+r.storeId+"]"))))});var e=document.createElement("div");e.classList.add("map-wid"),e.innerHTML="<h3>"+b.name+"</h3>"+(b.address.streetAddressLine1?"<p>"+b.address.streetAddressLine1:"")+(b.address.streetAddressLine2?b.address.streetAddressLine2:"")+(b.address.streetAddressLine3?b.address.streetAddressLine3+"</p>":""),c.appendChild(d),c.appendChild(e),s=new AMap.InfoWindow({isCustom:!0,closeWhenClickMap:!0,content:c,offset:new AMap.Pixel(0,-60)}),p.setCenter(a.getPosition()),s.open(p,a.getPosition())}function h(a){if(!(v>6)){if(x.refreshToken&&u)return void(a&&a());x.refreshToken&&x.refreshToken.abort(),x.refreshToken=$.ajax({url:"/TRIGGER/starbucks/getStoreLocator",success:function(b){u=b,a&&a()},error:function(){v++,u=null}})}}function i(a,b,c){return"https://openapi.starbucks.com/v1/stores/nearby?limit=10&radius=10&latlng="+a.latitude+","+a.longitude+"&access_token="+b+"&locale="+c}function j(a){if(!u)return h(function(){j(a)});x.loadNearbyStores&&x.loadNearbyStores.abort();try{$.ajax({url:i(a,u,z),dataType:"jsonp",statusCode:{401:function(){u=null,h(function(){j(a)})}},success:function(a){if(a&&a.stores&&0!==a.stores.length){for(var b=0;b<a.stores.length;b++){var h=a.stores[b].store;null==y[h.id]&&(y[h.id]={inst:h,marker:e(h)},d(h))}$(".mapclick").off().on("click",function(){if($(this).find(".mapdetail").is(":hidden")){c($(this));var a=y[$(this).attr("storeId")];return void g(a.marker,a.inst)}f($(this));var a=y[$(this).attr("storeId")];return s&&s.close(),void(r&&r.setAnimation(G.none))})}}})}catch(b){}}function k(a){var b=a.attr("defaultvalue"),c=$.trim(a.val());""!=c&&c!=b&&n(c)}function l(a){j({longitude:a.position.getLng(),latitude:a.position.getLat()}),p.setZoom(14)}function m(a){o()}function n(a){var b;AMap.plugin("AMap.PlaceSearch",function(){b=new AMap.PlaceSearch,b.search(a,function(a,b){if("complete"===a&&b.poiList&&b.poiList.pois&&b.poiList.pois.length>0){var c=b.poiList.pois[0];p.setZoom(15),p.setCenter(c.location),j({longitude:c.location.getLng(),latitude:c.location.getLat()})}})})}function o(){var a=p.getCenter();j({longitude:a.getLng(),latitude:a.getLat()})}var p,q,p,r,s,t="map-canvas",u=null,v=0,w=$(".search .btn"),x={},y={},z="zh",A=!1,B=new AMap.Icon({image:"/_themes/starbucks/img/storeLocatorIconSmall.png",size:new AMap.Size(23,30),imageSize:new AMap.Size(23,30)}),C={storeOpen:"营业时间：",storeOpen24Hours:"24小时营业",storeNotOpenTime:"无",noStoreSearched:"没有找到门店，请尝试其他关键字。",sunday:"周日",monday:"周一",tuesday:"周二",wednesday:"周三",thursday:"周四",friday:"周五",saturday:"周六",to:"至"},D={storeOpen:"Open:",storeOpen24Hours:"Open 24 hours",storeNotOpenTime:"Closed",noStoreSearched:"No stores found. Please try another search.",sunday:"Sunday",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",to:"to"};z=document.URL.toLowerCase().indexOf("/cn/")>=0?"zh":"en";var E="zh"===z?C:D,F=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/MicroMessenger/i)||navigator.userAgent.match(/windows\sphone/i))&&(A=!0);var G={none:"AMAP_ANIMATION_NONE",drop:"AMAP_ANIMATION_DROP",bounce:"AMAP_ANIMATION_BOUNCE"};A&&(G.drop=G.bounce=G.none),w.click(function(){var a=$(this).parent().find(".inputtext");k(a)}),$(".inputtext").keydown(function(a){a.keyCode&&13===a.keyCode&&k($(a.target))}),p=new AMap.Map(t,{resizeEnable:!0,zoom:10,center:[116.397428,39.90923]}),h(),AMap.plugin("AMap.ToolBar",function(){var a=new AMap.ToolBar;p.addControl(a)}),p.on("dragend",o),p.plugin("AMap.Geolocation",function(){q=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,showButton:!0,buttonPosition:A?"LB":"RB",buttonOffset:new AMap.Pixel(10,20),showMarker:!0,showCircle:!0,panToLocation:!0,zoomToAccuracy:!0}),p.addControl(q),q.getCurrentPosition(),AMap.event.addListener(q,"complete",l),AMap.event.addListener(q,"error",m)})});